function loadWidget(e){let{waifuPath:o,modelListPath:t,apiPath:s,cdnPath:n}=e;let l=false,d;if(typeof n==="string"){l=true;if(!n.endsWith("/"))n+="/"}else if(typeof s==="string"){if(!s.endsWith("/"))s+="/"}else{console.error("Invalid initWidget argument!");return}localStorage.removeItem("waifu-display");sessionStorage.removeItem("waifu-text");document.body.insertAdjacentHTML("beforeend",`<div id="waifu">
			<div id="waifu-tips"></div>
			<canvas id="live2d" width="1024" height="1024"></canvas>
			<div id="waifu-tool">
				<span class="fa fa-lg fa-comment"></span>
				<span class="fa fa-lg fa-paper-plane"></span>
				<span class="fa fa-lg fa-user-circle"></span>
				<span class="fa fa-lg fa-street-view"></span>
				<span class="fa fa-lg fa-camera-retro"></span>
				<span class="fa fa-lg fa-heart-o"></span>
				<span class="fa fa-lg fa-info-circle"></span>
				<span class="fa fa-lg fa-times"></span>
			</div>
		</div>`);setTimeout(()=>{var e=document.getElementById("waifu");e.style.bottom=0},0);function r(e){return Array.isArray(e)?e[Math.floor(Math.random()*e.length)]:e}let i=false,a,c,f=["好久不见，日子过得好快呢……","大坏蛋！你都多久没理人家了呀，嘤嘤嘤～","嗨～快来逗我玩吧！","拿小拳拳锤你胸口！"];window.addEventListener("mousemove",()=>i=true);window.addEventListener("keydown",()=>i=true);setInterval(()=>{if(i){i=false;clearInterval(a);a=null}else if(!a){a=setInterval(()=>{m(r(f),6e3,9)},2e4)}},1e3);(function e(){document.querySelector("#waifu-tool .fa-comment").addEventListener("click",u);document.querySelector("#waifu-tool .fa-paper-plane").addEventListener("click",()=>{if(window.Asteroids){if(!window.ASTEROIDSPLAYERS)window.ASTEROIDSPLAYERS=[];window.ASTEROIDSPLAYERS.push(new Asteroids)}else{const e=document.createElement("script");e.src="https://cdn.jsdelivr.net/gh/stevenjoezhang/asteroids/asteroids.js";document.head.appendChild(e)}});document.querySelector("#waifu-tool .fa-user-circle").addEventListener("click",h);document.querySelector("#waifu-tool .fa-street-view").addEventListener("click",v);document.querySelector("#waifu-tool .fa-camera-retro").addEventListener("click",()=>{m("照好了嘛，是不是很可爱呢？",6e3,9);Live2D.captureName="photo.png";Live2D.captureFrame=true});document.querySelector("#waifu-tool .fa-heart-o").addEventListener("click",y);document.querySelector("#waifu-tool .fa-info-circle").addEventListener("click",()=>{open("https://cwhisme.ml/about/")});document.querySelector("#waifu-tool .fa-times").addEventListener("click",()=>{localStorage.setItem("waifu-display",Date.now());m("愿你有一天能与重要的人重逢。",2e3,11);document.getElementById("waifu").style.bottom="-500px";setTimeout(()=>{document.getElementById("waifu").style.display="none";document.getElementById("waifu-toggle").classList.add("waifu-toggle-active")},3e3)});const t=()=>{};console.log("%c",t);t.toString=()=>{m("哈哈，你打开了控制台，是想要看看我的小秘密吗？",6e3,9)};window.addEventListener("copy",()=>{m("你都复制了些什么呀，转载要记得加上出处哦！",6e3,9)});window.addEventListener("visibilitychange",()=>{if(!document.hidden)m("哇，你终于回来了～",6e3,9)})})();(function e(){let t;if(location.pathname==="/"){const i=(new Date).getHours();if(i>5&&i<=7)t="早上好！一日之计在于晨，美好的一天就要开始了。";else if(i>7&&i<=11)t="上午好！工作顺利嘛，不要久坐，多起来走动走动哦！";else if(i>11&&i<=13)t="中午了，工作了一个上午，现在是午餐时间！";else if(i>13&&i<=17)t="午后很容易犯困呢，今天的运动目标完成了吗？";else if(i>17&&i<=19)t="傍晚了！窗外夕阳的景色很美丽呢，最美不过夕阳红～";else if(i>19&&i<=21)t="晚上好，今天过得怎么样？";else if(i>21&&i<=23)t=["已经这么晚了呀，早点休息吧，晚安～","深夜时要爱护眼睛呀！"];else t="你是夜猫子呀？这么晚还不睡觉，明天起的来嘛？"}else if(document.referrer!==""){const o=new URL(document.referrer),a=o.hostname.split(".")[1];if(location.hostname===o.hostname)t=`欢迎阅读<span>「${document.title.split(" - ")[0]}」</span>`;else if(a==="baidu")t=`Hello！来自 百度搜索 的朋友<br>你是搜索 <span>${o.search.split("&wd=")[1].split("&")[0]}</span> 找到的我吗？`;else if(a==="so")t=`Hello！来自 360搜索 的朋友<br>你是搜索 <span>${o.search.split("&q=")[1].split("&")[0]}</span> 找到的我吗？`;else if(a==="google")t=`Hello！来自 谷歌搜索 的朋友<br>欢迎阅读<span>「${document.title.split(" - ")[0]}」</span>`;else t=`Hello！来自 <span>${o.hostname}</span> 的朋友`}else{t=`欢迎阅读<span>「${document.title.split(" - ")[0]}」</span>`}m(t,7e3,8)})();function u(){fetch("https://v1.hitokoto.cn").then(e=>e.json()).then(e=>{const t=`这句一言来自 <span>「${e.from}」</span>，是 <span>${e.creator}</span> 在 hitokoto.cn 投稿的。`;m(e.hitokoto,6e3,9);setTimeout(()=>{m(t,4e3,9)},6e3)})}function m(e,t,i){if(!e||sessionStorage.getItem("waifu-text")&&sessionStorage.getItem("waifu-text")>i)return;if(c){clearTimeout(c);c=null}e=r(e);sessionStorage.setItem("waifu-text",i);const o=document.getElementById("waifu-tips");o.innerHTML=e;o.classList.add("waifu-tips-active");c=setTimeout(()=>{sessionStorage.removeItem("waifu-text");o.classList.remove("waifu-tips-active")},t)}(function e(){let t=localStorage.getItem("modelId"),i=localStorage.getItem("modelTexturesId");if(t===null){p()}else w(t,i);y();fetch(o).then(e=>e.json()).then(o=>{window.addEventListener("mouseover",i=>{for(let{selector:e,text:t}of o.mouseover){if(!i.target.matches(e))continue;t=r(t);t=t.replace("{text}",i.target.innerText);m(t,4e3,8);return}});window.addEventListener("click",i=>{for(let{selector:e,text:t}of o.click){if(!i.target.matches(e))continue;t=r(t);t=t.replace("{text}",i.target.innerText);m(t,4e3,8);return}});o.seasons.forEach(({date:e,text:t})=>{const i=new Date,o=e.split("-")[0],a=e.split("-")[1]||o;if(o.split("/")[0]<=i.getMonth()+1&&i.getMonth()+1<=a.split("/")[0]&&(o.split("/")[1]<=i.getDate()&&i.getDate()<=a.split("/")[1])){t=r(t);t=t.replace("{year}",i.getFullYear());f.push(t)}})})})();async function g(){const e=await fetch(t==null?`${n}model_list.json`:t);d=await e.json()}async function p(){if(!d)await g();modelId=d.defaultModelInfo[0];modelTexturesId=d.defaultModelInfo[1];w(modelId,modelTexturesId,"",d.defaultModelInfo[2])}async function w(e,t,i,o=null){localStorage.setItem("modelId",e);localStorage.setItem("modelTexturesId",t);m(i,4e3,10);if(l){if(!d)await g();const a=r(d.models[e]);loadlive2d("live2d",`${n}model/${o==null?a:o}/index.json`);document.querySelector("#waifu-tool .fa-street-view").style.display=I(d.models[e])?"block":"none"}else{loadlive2d("live2d",`${s}get/?id=${e}-${t}`);console.log(`Live2D 模型 ${e}-${t} 加载完成`)}}async function v(){const t=localStorage.getItem("modelId"),i=localStorage.getItem("modelTexturesId");if(l){if(!d)await g();if(I(d.models[t])){var e=r(d.models[t]);var o=localStorage.getItem("modelName");while(e==o)e=r(d.models[t]);localStorage.setItem("modelName",e);m("好的，我去换衣服去啦 ~",4e3,10);await loadlive2d("live2d",`${n}model/${e}/index.json`);m("我的新衣服好看嘛？",4e3,10)}else m("我还没有其他衣服呢！",4e3,10)}else{fetch(`${s}rand_textures/?id=${t}-${i}`).then(e=>e.json()).then(e=>{if(e.textures.id===1&&(i===1||i===0))m("我还没有其他衣服呢！",4e3,10);else w(t,e.textures.id,"我的新衣服好看嘛？")})}}async function h(){let e=localStorage.getItem("modelId");if(l){if(!d)await g();const t=++e>=d.models.length?0:e;w(t,0,d.messages[t])}else{fetch(`${s}switch/?id=${e}`).then(e=>e.json()).then(e=>{w(e.model.id,0,e.model.message)})}}async function y(e=false){if(!d)await g();var t=Number(sessionStorage.getItem("sizeZoomIndex"));if(t>=d.sizeZoomList.length||!(typeof t=="number"&&!isNaN(t)))t=0;var i=d.sizeZoomList[t];if(e){t++;m("好的啦 ~~~",2e3,9)}const o=15;var a=d.sizeZoomList[t]+o;var s;if(a>=document.body.clientHeight||a>=document.body.clientWidth){if(i+o>=document.body.clientWidth){t=0;s=d.sizeZoomList[t];m("你的浏览器界面太小了，再大一点可就装不下啦 ~",5e3,9)}else s=document.body.clientWidth-o}else s=d.sizeZoomList[t];var n=document.querySelector("#waifu #live2d");n.style.height=s+"px";n.style.width=s+"px";sessionStorage.setItem("sizeZoomIndex",t)}function I(e){return e.length>1&&typeof e!="string"}}function initWidget(e,t){if(typeof e==="string"){e={waifuPath:e,apiPath:t}}document.body.insertAdjacentHTML("beforeend",`<div id="waifu-toggle">
			<span>看板娘</span>
		</div>`);const i=document.getElementById("waifu-toggle");i.addEventListener("click",()=>{i.classList.remove("waifu-toggle-active");if(i.getAttribute("first-time")){loadWidget(e);i.removeAttribute("first-time")}else{localStorage.removeItem("waifu-display");document.getElementById("waifu").style.display="";setTimeout(()=>{document.getElementById("waifu").style.bottom=0},0)}});if(localStorage.getItem("waifu-display")&&Date.now()-localStorage.getItem("waifu-display")<=864e5){i.setAttribute("first-time",true);setTimeout(()=>{i.classList.add("waifu-toggle-active")},0)}else{loadWidget(e)}}